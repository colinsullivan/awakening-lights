---
- name: update and deploy
  become_user: "{{ awakening_lights_install_user }}"
  include_tasks: deploy.yml

- name: Install nginx
  apt:
    name: nginx
    state: present

- name: nginx started and enabled
  systemd:
    name: nginx
    state: started
    enabled: true

- name: install lights.local nginx conf to serve react app
  template:
    src: lights.local.conf.j2
    dest: /etc/nginx/conf.d/lights.local.conf
  register: lights_local_conf

- name: reload nginx
  systemd:
    name: nginx
    state: reloaded
  when: lights_local_conf.changed
